<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0">
    <title>WillTube</title>
    <meta name="description" content="Will's personal video collection">
    <meta name="keywords" content="videos, 4K, streaming, portfolio, tutorials">
    
    <!-- HLS.js for broader browser compatibility -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 11px;
            background: linear-gradient(135deg, #f8f8f8 0%, #e8e8e8 100%);
            color: #333333;
            line-height: 1.4;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 10px;
            background: #ffffff;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-left: 1px solid #dddddd;
            border-right: 1px solid #dddddd;
            min-height: 100vh;
        }

        /* Header Section */
        .header {
            text-align: center;
            padding: 20px 0 15px 0;
        }

        .logo {
            margin-bottom: 8px;
        }

        .logo img {
            max-width: 300px;
            height: auto;
        }

        .subtitle {
            font-size: 13px;
            color: #666666;
            margin-bottom: 20px;
        }

        /* Instructions Section */
        .instructions {
            background: linear-gradient(to bottom, #f0f8ff, #e6f3ff);
            border: 2px solid #4080ff;
            border-radius: 3px;
            padding: 12px;
            margin-bottom: 15px;
            font-size: 11px;
            text-align: left;
            box-shadow: 0 2px 5px rgba(64,128,255,0.1);
        }

        .instructions h3 {
            font-size: 12px;
            margin-bottom: 8px;
            color: #004080;
            border-bottom: 1px solid #cce6ff;
            padding-bottom: 4px;
        }

        /* Search Section */
        .search-section {
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 0;
        }

        .search-box {
            width: 300px;
            height: 22px;
            border: 2px inset #e0e0e0;
            padding: 2px 5px;
            font-size: 11px;
            font-family: Arial, Helvetica, sans-serif;
            background: #ffffff;
        }

        .search-box:focus {
            border-color: #4080ff;
            outline: none;
            box-shadow: 0 0 5px rgba(64,128,255,0.3);
        }

        .search-button {
            height: 26px;
            padding: 0 12px;
            margin-left: 5px;
            background: linear-gradient(to bottom, #4080ff, #2060df);
            border: 1px outset #4080ff;
            font-size: 11px;
            cursor: pointer;
            font-family: Arial, Helvetica, sans-serif;
            color: #ffffff;
            font-weight: bold;
        }

        .search-button:hover {
            background: linear-gradient(to bottom, #5090ff, #3070ef);
        }

        .search-button:active {
            border: 1px inset #2060df;
            background: linear-gradient(to bottom, #2060df, #4080ff);
        }

        /* Featured Section */
        .featured-section {
            margin-bottom: 20px;
        }

        .section-title {
            background: linear-gradient(to bottom, #cc0000, #990000);
            border: 1px solid #660000;
            padding: 6px 12px;
            font-size: 12px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 10px;
            text-shadow: 1px 1px 1px rgba(0,0,0,0.5);
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .featured-videos {
            display: flex;
            gap: 22px;
            overflow-x: auto;
            padding: 15px;
            background: linear-gradient(to bottom, #f8f8f8, #f0f0f0);
            border: 1px solid #dddddd;
            border-radius: 3px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        .featured-video {
            flex: 0 0 auto;
            width: 210px;
            text-align: center;
            cursor: pointer;
            background: #ffffff;
            border: 1px solid #dddddd;
            border-radius: 2px;
            padding: 8px;
            transition: all 0.2s;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .featured-video:hover {
            border-color: #4080ff;
            box-shadow: 0 2px 8px rgba(64,128,255,0.3);
            transform: translateY(-2px);
        }

        .featured-thumbnail {
            width: 194px;
            height: 146px;
            border: 1px solid #cccccc;
            background: #f5f5f5;
            margin-bottom: 5px;
            position: relative;
            overflow: hidden;
            border-radius: 2px;
        }

        .featured-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .featured-title {
            font-size: 10px;
            color: #cc0000;
            text-decoration: none;
            margin-bottom: 3px;
            line-height: 1.2;
            font-weight: bold;
        }

        .featured-info {
            font-size: 9px;
            color: #666666;
        }

        /* Video Player Section */
        .player-section {
            margin-bottom: 25px;
            display: none;
        }

        .player-container {
            border: 1px solid #cccccc;
            background: #ffffff;
            overflow: hidden;
        }

        .player-content {
            display: flex;
            gap: 30px;
            padding: 18px;
        }

        .video-player {
            flex: 0 0 640px;
            height: 480px;
            background: #000000;
            border: 1px solid #999999;
            position: relative;
            overflow: hidden;
        }

        .video-element {
            width: 100%;
            height: 100%;
            object-fit: contain;
            image-rendering: high-quality;
            image-rendering: -webkit-optimize-contrast;
            image-rendering: optimize-quality;
        }

        /* Custom retro video controls */
        .video-element::-webkit-media-controls-panel {
            background: linear-gradient(to bottom, #f0f0f0, #d0d0d0);
            border-top: 1px solid #999999;
        }

        .video-element::-webkit-media-controls-current-time-display,
        .video-element::-webkit-media-controls-time-remaining-display {
            font-family: 'Courier New', monospace;
            font-size: 10px;
            color: #333333;
        }

        /* Quality selector */
        .quality-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 100;
        }

        .quality-button {
            background: linear-gradient(to bottom, rgba(240,240,240,0.9), rgba(220,220,220,0.9));
            border: 1px outset #d0d0d0;
            padding: 4px 8px;
            font-size: 9px;
            cursor: pointer;
            color: #333333;
            border-radius: 2px;
            font-family: Arial, Helvetica, sans-serif;
        }

        .quality-button:hover {
            background: linear-gradient(to bottom, rgba(255,255,255,0.9), rgba(240,240,240,0.9));
        }

        .quality-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: #ffffff;
            border: 1px solid #cccccc;
            border-radius: 2px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            display: none;
            min-width: 80px;
        }

        .quality-option {
            padding: 4px 8px;
            font-size: 9px;
            cursor: pointer;
            border-bottom: 1px solid #eeeeee;
        }

        .quality-option:last-child {
            border-bottom: none;
        }

        .quality-option:hover {
            background: #f0f0f0;
        }

        .quality-option.active {
            background: #e0e8ff;
            color: #0066cc;
        }

        /* Retro overlay controls for cross-browser compatibility */
        .retro-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to bottom, #f5f5f5, #e8e8e8);
            border-top: 1px solid #cccccc;
            padding: 4px 6px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: Arial, Helvetica, sans-serif;
            font-size: 10px;
            opacity: 0;
            transition: opacity 0.3s;
            height: 24px;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.5);
        }

        .video-player:hover .retro-controls {
            opacity: 1;
        }

        .retro-button {
            width: 20px;
            height: 16px;
            background: linear-gradient(to bottom, #f8f8f8, #e0e0e0);
            border: 1px outset #d0d0d0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #333333;
            transition: all 0.1s;
            border-radius: 1px;
        }

        .retro-button:hover {
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            border-color: #b0b0b0;
        }

        .retro-button:active {
            border: 1px inset #d0d0d0;
            background: linear-gradient(to bottom, #e0e0e0, #f0f0f0);
        }

        /* WORKING PROGRESS BAR - FROM WORKING VERSION */
        .progress-container {
            flex: 1;
            height: 12px;
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            border: 1px inset #d0d0d0;
            margin: 0 4px;
            position: relative;
            cursor: pointer;
            border-radius: 1px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to bottom, #4080ff, #2060df);
            width: 0%;
            transition: width 0.1s linear;
            position: relative;
            border-radius: 1px;
        }

        .progress-handle {
            position: absolute;
            right: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 8px;
            background: linear-gradient(to bottom, #ffffff, #e0e0e0);
            border: 1px solid #a0a0a0;
            cursor: grab;
            border-radius: 1px;
        }

        .progress-handle:active {
            cursor: grabbing;
        }

        /* Buffer indicator */
        .buffer-bar {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(to bottom, #d0d0d0, #c0c0c0);
            width: 0%;
            transition: width 0.3s;
            border-radius: 1px;
        }

        .time-display {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 9px;
            color: #333333;
            background: transparent;
            padding: 0;
            line-height: 14px;
            white-space: nowrap;
        }

        .time-container {
            display: flex;
            align-items: center;
            gap: 1px;
            min-width: fit-content;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 3px;
        }

        .volume-icon {
            width: 16px;
            height: 14px;
            background: linear-gradient(to bottom, #f8f8f8, #e0e0e0);
            border: 1px outset #d0d0d0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8px;
            color: #333333;
            border-radius: 1px;
        }

        .volume-icon:hover {
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
        }

        .volume-slider {
            width: 50px;
            height: 8px;
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            border: 1px inset #d0d0d0;
            position: relative;
            cursor: pointer;
            border-radius: 1px;
        }

        .volume-bar {
            height: 100%;
            background: linear-gradient(to bottom, #40c040, #20a020);
            width: 80%;
            position: relative;
            border-radius: 1px;
        }

        .volume-handle {
            position: absolute;
            right: -1px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 6px;
            background: linear-gradient(to bottom, #ffffff, #e0e0e0);
            border: 1px solid #a0a0a0;
            cursor: grab;
            border-radius: 1px;
        }

        .fullscreen-button {
            width: 50px;
            height: 16px;
            background: linear-gradient(to bottom, #f8f8f8, #e0e0e0);
            border: 1px outset #d0d0d0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 9px;
            color: #333333;
            border-radius: 1px;
            font-family: Arial, Helvetica, sans-serif;
        }

        .fullscreen-button:hover {
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            border-color: #b0b0b0;
        }

        .fullscreen-button:active {
            border: 1px inset #d0d0d0;
            background: linear-gradient(to bottom, #e0e0e0, #f0f0f0);
        }

        /* Loading spinner */
        .loading-spinner {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 32px;
            height: 32px;
            border: 3px solid #cccccc;
            border-top: 3px solid #0066cc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: none;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* Pixelated effect overlay */
        .pixel-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(90deg, transparent 98%, rgba(0,0,0,0.1) 100%),
                linear-gradient(180deg, transparent 98%, rgba(0,0,0,0.1) 100%);
            background-size: 2px 2px;
            pointer-events: none;
            opacity: 0.3;
        }

        .video-info-panel {
            flex: 1;
            min-width: 330px;
        }

        .video-title-playing {
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333333;
            line-height: 1.2;
        }

        .video-stats {
            font-size: 10px;
            color: #666666;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eeeeee;
        }

        .video-description-playing {
            font-size: 11px;
            color: #666666;
            line-height: 1.4;
            margin-bottom: 12px;
        }

        .video-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-button {
            font-size: 10px;
            padding: 3px 8px;
            border: 1px solid #cccccc;
            background: #f8f8f8;
            color: #333333;
            text-decoration: none;
            cursor: pointer;
        }

        .action-button:hover {
            background: #eeeeee;
            border-color: #999999;
        }

        /* Responsive player */
        @media (max-width: 600px) {
            .player-content {
                flex-direction: column;
                gap: 10px;
            }
            
            .video-player {
                flex: none;
                width: 100%;
                height: 200px;
            }
        }

        /* Gallery Section */
        .gallery-section {
            margin-bottom: 30px;
        }

        .category-filters {
            display: flex;
            gap: 8px;
            margin: 10px 0 15px 0;
            flex-wrap: wrap;
        }

        .category-button {
            padding: 4px 12px;
            background: linear-gradient(to bottom, #f8f8f8, #e0e0e0);
            border: 1px outset #d0d0d0;
            cursor: pointer;
            font-size: 10px;
            color: #333333;
            font-family: Arial, Helvetica, sans-serif;
            transition: all 0.1s;
            border-radius: 1px;
        }

        .category-button:hover {
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            border-color: #b0b0b0;
        }

        .category-button.active {
            background: linear-gradient(to bottom, #4080ff, #2060df);
            color: white;
            border: 1px inset #2060df;
        }

        .category-button:active {
            border: 1px inset #d0d0d0;
            background: linear-gradient(to bottom, #e0e0e0, #f0f0f0);
        }

        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 30px;
            margin-top: 10px;
        }

        .video-item {
            cursor: pointer;
            border: 1px solid #ffffff;
            padding: 8px;
            transition: border-color 0.2s;
        }

        .video-item:hover {
            border: 1px solid #cccccc;
            background: #fafafa;
        }

        .video-item.hidden {
            display: none;
        }

        .video-thumbnail {
            width: 100%;
            height: 168px;
            border: 1px solid #cccccc;
            background: #f5f5f5;
            margin-bottom: 8px;
            overflow: hidden;
            position: relative;
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-info h4 {
            font-size: 11px;
            color: #0066cc;
            text-decoration: underline;
            margin-bottom: 4px;
            line-height: 1.2;
        }

        .video-description {
            font-size: 10px;
            color: #666666;
            line-height: 1.3;
        }

        .video-meta {
            font-size: 9px;
            color: #999999;
            margin-top: 4px;
        }

        .category-tag {
            display: inline-block;
            background: #f0f0f0;
            border: 1px solid #cccccc;
            padding: 1px 4px;
            font-size: 8px;
            color: #666666;
            margin-top: 2px;
            border-radius: 1px;
        }

        /* Footer */
        .footer {
            border-top: 1px solid #cccccc;
            padding: 15px 0;
            text-align: center;
            font-size: 10px;
            color: #666666;
            margin-top: 30px;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 0 5px;
            }

            .header {
                padding: 15px 0 10px 0;
            }

            .logo-placeholder {
                width: 250px;
                height: 60px;
                font-size: 10px;
            }

            .subtitle {
                font-size: 12px;
                margin-bottom: 15px;
            }

            .instructions {
                padding: 10px;
                font-size: 10px;
                margin-bottom: 10px;
            }

            .instructions h3 {
                font-size: 11px;
                margin-bottom: 6px;
            }

            .search-section {
                padding: 10px 0;
                margin-bottom: 15px;
            }

            .search-box {
                width: 250px;
                height: 28px;
                font-size: 12px;
            }

            .search-button {
                height: 32px;
                padding: 0 10px;
                font-size: 10px;
            }

            .section-title {
                padding: 4px 8px;
                font-size: 11px;
                margin-bottom: 8px;
            }

            .featured-videos {
                padding: 8px;
                gap: 10px;
            }

            .featured-video {
                width: 120px;
                padding: 4px;
            }

            .featured-thumbnail {
                width: 112px;
                height: 84px;
            }

            .featured-title {
                font-size: 9px;
                margin-bottom: 2px;
            }

            .featured-info {
                font-size: 8px;
            }

            .category-filters {
                gap: 5px;
                margin: 8px 0 10px 0;
            }

            .category-button {
                padding: 3px 8px;
                font-size: 9px;
            }

            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 10px;
            }

            .video-item {
                padding: 6px;
            }

            .video-thumbnail {
                height: 80px;
            }

            .video-info h4 {
                font-size: 10px;
                margin-bottom: 3px;
            }

            .video-description {
                font-size: 9px;
                line-height: 1.2;
            }

            .video-meta {
                font-size: 8px;
                margin-top: 3px;
            }

            .category-tag {
                font-size: 7px;
                padding: 1px 3px;
                margin-top: 2px;
            }

            .footer {
                padding: 10px 0;
                font-size: 9px;
                margin: 20px -5px 0 -5px;
            }
        }

        /* Mobile player optimizations */
        @media (max-width: 768px) {
            .player-content {
                flex-direction: column;
                gap: 10px;
                padding: 8px;
            }
            
            .video-player {
                flex: none;
                width: 100%;
                height: 220px;
            }

            .video-info-panel {
                min-width: auto;
            }

            .video-title-playing {
                font-size: 12px;
                margin-bottom: 6px;
            }

            .video-stats {
                font-size: 9px;
                margin-bottom: 8px;
                padding-bottom: 6px;
            }

            .video-description-playing {
                font-size: 10px;
                margin-bottom: 8px;
            }

            .video-actions {
                gap: 6px;
            }

            .action-button {
                font-size: 9px;
                padding: 4px 8px;
            }
        }

        /* Mobile video controls */
        @media (max-width: 768px) {
            .retro-controls {
                padding: 6px 4px;
                gap: 4px;
                height: 32px;
            }

            .retro-button {
                width: 24px;
                height: 20px;
                font-size: 12px;
            }

            .time-container {
                gap: 1px;
            }

            .time-display {
                font-size: 8px;
            }

            .volume-container {
                gap: 2px;
            }

            .volume-icon {
                width: 20px;
                height: 18px;
                font-size: 10px;
            }

            .volume-slider {
                width: 30px;
                height: 10px;
            }

            .progress-container {
                margin: 0 2px;
                height: 16px;
            }

            .fullscreen-button {
                width: 40px;
                height: 20px;
                font-size: 8px;
            }

            .quality-selector {
                top: 5px;
                right: 5px;
            }

            .quality-button {
                padding: 6px 10px;
                font-size: 10px;
            }
        }

        /* Rating & Comment System Styles */
        .rating-section {
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eeeeee;
        }

        .rating-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            flex-wrap: wrap;
        }

        .rating-display {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .rating-stars {
            display: flex;
            gap: 2px;
        }

        .star {
            font-size: 14px;
            color: #ddd;
            cursor: pointer;
            transition: color 0.1s;
        }

        .star.filled {
            color: #ffd700;
        }

        .star:hover {
            color: #ffed4e;
        }

        .rating-text {
            font-size: 11px;
            color: #666666;
        }

        .user-rating {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-rating-label {
            font-size: 10px;
            color: #666666;
        }

        .rate-button {
            font-size: 9px;
            padding: 2px 6px;
            border: 1px solid #cccccc;
            background: #f8f8f8;
            color: #333333;
            cursor: pointer;
            border-radius: 2px;
            font-family: Arial, Helvetica, sans-serif;
        }

        .rate-button:hover {
            background: #eeeeee;
        }

        .rate-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Comments Section Styles */
        .comments-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: 200px;
        }

        .comments-header {
            font-size: 11px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333333;
            padding-bottom: 4px;
            border-bottom: 1px solid #eeeeee;
        }

        .comments-list {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 12px;
            max-height: 200px;
            padding-right: 4px;
        }

        .comment {
            background: #f8f8f8;
            border: 1px solid #dddddd;
            border-radius: 3px;
            padding: 8px;
            margin-bottom: 8px;
            display: flex;
            gap: 8px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .comment-avatar {
            width: 32px;
            height: 32px;
            border-radius: 2px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            font-weight: bold;
            flex-shrink: 0;
            overflow: hidden;
        }

        .comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comment-content {
            flex: 1;
        }

        .comment-author {
            font-size: 10px;
            font-weight: bold;
            color: #333333;
            margin-bottom: 2px;
        }

        .comment-text {
            font-size: 10px;
            color: #666666;
            line-height: 1.3;
            margin-bottom: 3px;
        }

        .comment-date {
            font-size: 8px;
            color: #999999;
        }

        .comment-form {
            border-top: 1px solid #eeeeee;
            padding-top: 8px;
        }

        /* Profile Picture Selector */
        .profile-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
            padding: 4px;
            border: 1px solid #eeeeee;
            border-radius: 3px;
            background: #fafafa;
            width: calc(100% - 10px);
            margin-right: 10px;
        }

        .profile-selector-label {
            font-size: 9px;
            color: #666666;
            white-space: nowrap;
        }

        .avatar-navigation {
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            justify-content: space-between;
        }

        .avatar-arrow {
            width: 20px;
            height: 24px;
            background: #e0e0e0;
            border: 1px solid #cccccc;
            border-radius: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #666666;
            transition: all 0.2s;
            user-select: none;
        }

        .avatar-arrow:hover {
            background: #d0d0d0;
            border-color: #aaaaaa;
        }

        .avatar-arrow:active {
            background: #c0c0c0;
        }

        .avatar-arrow:disabled,
        .avatar-arrow.disabled {
            background: #f0f0f0;
            color: #cccccc;
            cursor: not-allowed;
            border-color: #e0e0e0;
        }

        .avatar-row {
            display: flex;
            gap: 4px;
            width: 290px;
            overflow: hidden;
        }

        .avatar-choice {
            width: 24px;
            height: 24px;
            border-radius: 2px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
            color: white;
        }

        .avatar-choice:hover {
            border-color: #4080ff;
            transform: scale(1.1);
        }

        .avatar-choice.selected {
            border-color: #4080ff;
            box-shadow: 0 0 4px rgba(64, 128, 255, 0.5);
        }

        .comment-input {
            width: 100%;
            padding: 4px 6px;
            border: 1px solid #cccccc;
            font-size: 10px;
            font-family: Arial, Helvetica, sans-serif;
            margin-bottom: 6px;
            border-radius: 2px;
            box-sizing: border-box;
        }

        .comment-input:focus {
            border-color: #4080ff;
            outline: none;
        }

        .comment-textarea {
            width: 100%;
            height: 50px;
            padding: 4px 6px;
            border: 1px solid #cccccc;
            font-size: 10px;
            font-family: Arial, Helvetica, sans-serif;
            resize: none;
            margin-bottom: 6px;
            border-radius: 2px;
            box-sizing: border-box;
        }

        .comment-textarea:focus {
            border-color: #4080ff;
            outline: none;
        }

        .comment-submit {
            width: 100%;
            padding: 6px;
            background: linear-gradient(to bottom, #4080ff, #2060df);
            border: 1px outset #4080ff;
            color: white;
            font-size: 10px;
            cursor: pointer;
            border-radius: 2px;
            font-family: Arial, Helvetica, sans-serif;
            box-sizing: border-box;
        }

        .comment-submit:hover {
            background: linear-gradient(to bottom, #5090ff, #3070ef);
        }

        .comment-submit:active {
            border: 1px inset #2060df;
        }

        .comment-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .comments-list::-webkit-scrollbar {
            width: 6px;
        }

        .comments-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .comments-list::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }

        .comments-list::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
		.category-description {
    text-align: left;
    margin: 10px 0 15px 0;
}

.description-text {
    font-size: 11px;
    color: #666666;
    margin: 0;
}

/* Responsive adjustments */
@media (max-width: 768px) {
    .description-text {
        font-size: 10px;
    }
}
    </style>
</head>
<body>
    <div class="container">
        <!-- Header with Logo -->
        <div class="header">
            <div class="logo">
                <img src="willtube.png" alt="WillTube">
            </div>
            <div class="subtitle">Will's Digital Video Repository </div>
        </div>

        <!-- Instructions Section -->
        <div class="instructions">
            <h3>Welcome to WillTube!</h3>
            <p>Sit back, relax, and enjoy my work like you're scrolling youtube in the early 2000s, but it's just me!</p>
			<p>Not sure where to start? Check out the "Featured Videos" for the latest and greatest of my filmography.</p>
			<p>If you want to take a deeper dive visit my video gallery and take a trip down my filmmaking journey all the way to the beginning! Use the searchbar if you have a specific video in mind. </p>
        </div>

        <!-- Search Section -->
        <div class="search-section">
            <input type="text" class="search-box" placeholder="Search Videos" id="searchInput">
            <button class="search-button" onclick="searchVideos()">Search Videos</button>
        </div>

        <!-- Featured Releases Section -->
        <div class="featured-section">
            <div class="section-title">Featured Releases</div>
            <div class="featured-videos" id="featuredVideos">
                <!-- Featured videos will be populated here -->
            </div>
        </div>

        <!-- Video Player Section -->
        <div class="player-section" id="playerSection">
            <div class="section-title">Now Playing</div>
            <div class="player-container">
                <div class="player-content">
                    <div class="video-player">
                        <video class="video-element" id="mainPlayer" controls>
                            <source id="videoSource" src="" type="application/x-mpegURL">
                            Your browser does not support HLS video playback.
                        </video>
                        <div class="pixel-overlay"></div>
                        <div class="loading-spinner" id="loadingSpinner"></div>
                        
                        <!-- Quality Selector -->
                        <div class="quality-selector">
                            <div class="quality-button" onclick="toggleQualityDropdown()">
                                Quality: <span id="currentQuality">Auto</span>
                            </div>
                            <div class="quality-dropdown" id="qualityDropdown">
                                <!-- Quality options will be populated dynamically -->
                            </div>
                        </div>
                        
                        <!-- FIXED PROGRESS BAR CONTROLS -->
                        <div class="retro-controls" id="retroControls">
                            <div class="retro-button" id="playPauseBtn" onclick="togglePlayPause()">â–¶</div>
                            <div class="retro-button" onclick="stopVideo()">â– </div>
                            <div class="time-container">
                                <div class="time-display" id="currentTime">00:00</div>
                                <div class="time-display">/</div>
                                <div class="time-display" id="duration">00:00</div>
                            </div>
                            <div class="volume-container">
                                <div class="volume-icon" onclick="toggleMute()">ðŸ”Š</div>
                                <div class="volume-slider" onclick="setVolume(event)">
                                    <div class="volume-bar" id="volumeBar">
                                        <div class="volume-handle"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="progress-container" onclick="seekVideo(event)">
                                <div class="buffer-bar" id="bufferBar"></div>
                                <div class="progress-bar" id="progressBar">
                                    <div class="progress-handle"></div>
                                </div>
                            </div>
                            <div class="fullscreen-button" onclick="toggleFullscreen()">Fullscreen</div>
                        </div>
                    </div>
                    <div class="video-info-panel">
                        <div class="video-title-playing" id="currentTitle">Video Title</div>
                        <div class="video-stats" id="currentStats">Views: 0 | Added: Today</div>
                        <div class="video-description-playing" id="currentDescription">Video description will appear here when you select a video to play.</div>
                        <div class="video-actions">
                            <button class="action-button" onclick="shareVideo()">Share</button>
                            <button class="action-button" onclick="toggleFavorite()">Favorite</button>
                            <button class="action-button" onclick="downloadVideo()">Download</button>
                        </div>
                        <div class="rating-section">
                            <div class="rating-row">
                                <div class="rating-display">
                                    <div class="rating-stars" id="avgRatingStars">
                                        <span class="star">â˜†</span>
                                        <span class="star">â˜†</span>
                                        <span class="star">â˜†</span>
                                        <span class="star">â˜†</span>
                                        <span class="star">â˜†</span>
                                    </div>
                                    <div class="rating-text" id="ratingText">No ratings yet</div>
                                </div>
                                <div class="user-rating">
                                    <div class="user-rating-label">Your rating:</div>
                                    <div class="rating-stars" id="userRatingStars">
                                        <span class="star" data-rating="1" onclick="setUserRating(1)">â˜†</span>
                                        <span class="star" data-rating="2" onclick="setUserRating(2)">â˜†</span>
                                        <span class="star" data-rating="3" onclick="setUserRating(3)">â˜†</span>
                                        <span class="star" data-rating="4" onclick="setUserRating(4)">â˜†</span>
                                        <span class="star" data-rating="5" onclick="setUserRating(5)">â˜†</span>
                                    </div>
                                    <button class="rate-button" id="submitRating" onclick="submitRating()" disabled>Rate</button>
                                </div>
                            </div>
                    
                            <div class="comments-section">
                                <div class="comments-header" id="commentsHeader">Comments (0)</div>
                                <div class="comments-list" id="commentsList">
                                    <!-- Comments will appear here -->
                                </div>
                                <div class="comment-form">
                                    <div class="profile-selector">
                                        <div class="profile-selector-label">Avatar:</div>
                                        <div class="avatar-navigation">
                                            <div class="avatar-arrow" id="avatarPrev" onclick="previousAvatarPage()">â—€</div>
                                            <div class="avatar-row" id="avatarRow">
                                                <!-- Avatar options will be populated here -->
                                            </div>
                                            <div class="avatar-arrow" id="avatarNext" onclick="nextAvatarPage()">â–¶</div>
                                        </div>
                                    </div>
                                    <input type="text" class="comment-input" id="commentName" placeholder="Your name..." maxlength="50">
                                    <textarea class="comment-textarea" id="commentMessage" placeholder="Leave a comment..." maxlength="500"></textarea>
                                    <button class="comment-submit" id="submitComment" onclick="submitComment()">Post Comment</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gallery Section -->
        <div class="gallery-section">
            <div class="section-title">Video Gallery</div>
            <div class="category-filters" id="categoryFilters">
                <!-- Category buttons will be populated here -->
            </div>
			<div class="category-description" id="categoryDescription">
    <p class="description-text">
        <b>Description:</b> <span id="categoryText">Browse all of WillTube in this section! If you watch them all you get a prize :)</span>
    </p>
</div>
            <div class="video-grid" id="videoGrid">
                <!-- Video items will be populated here -->
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>&copy; 2024 WillTube | Powered by <a href="#">Bunny CDN</a> </p>
        </div>
    </div>

    <script>
        // ============================================
        // WILLTUBE HLS BUNNY CDN INTEGRATION SYSTEM
        // ============================================
        
        // Configuration
        const BUNNY_CONFIG = {
            pullZone: 'vz-8a765295-4d7', // Your Bunny pull zone
            baseUrl: 'https://vz-8a765295-4d7.b-cdn.net'
        };

        // HLS instance for quality control
        let hlsInstance = null;
        let currentVideoId = null;

        // ============================================
        // VIDEO DATABASE - SIMPLIFIED FOR HLS
        // ============================================
        
        // Define your collections/categories
const COLLECTIONS = {

whm: { 
        name: 'Wills Home Movies', 
        color: '#ff8040',
        description: 'When did home movies become a derogatory term? I dont know but I aim to change that with this series of films capturing subjects both real and ficticious. Each film is recorded on Mini DV tapes on the legendary Canon GL2 and painstakingly digitized by me at home.'
    },

	dc: { 
        name: 'Directors Cuts', 
        color: '#40ff80',
        description: 'The creme of the crop. All of the films directed by me along with most of the crew positions due to budget constraints, but at least I can say its true to my vision.'
    },

    fs: { 
        name: 'Film School', 
        color: '#cc0000',
        description: 'Through my tenure at the prestige DePaul university I created a lot of work, and though I would like to erase some from my brain there are a lot of gems which I feature here. '
    },

	l2: { 
        name: 'Lighting 2', 
        color: '#40ff80',
        description: 'Jerry Tran, the iconic DePaul film professor, has gifted me with his lighting knowlegde and this is a collection of my favorite excersizes from his class.'
    },

    lu: { 
        name: 'Laker Update', 
        color: '#4080ff',
        description: 'Student journalism at its finest, or at least quickest. Our news director gave us only 2 minutes to tell our story so we ran with that, literally. Doing my best Billy on the Street impression I terrorized my school with whatever topic we could come up with each week, ranging from dress code violations to santa conspiracy theories.'
    },

    og: { 
        name: 'Origin Story', 
        color: '#40ff80',
        description: 'Where it all started. If you are an employer please do not judge me by the films I made when I was 9. I like to keep these here though as a reminder to never lose my sparkle :)'
    },
};

        // Video database - simplified for HLS (no resolution arrays needed)
        const VIDEO_DATABASE = {
		
			
			
			'377777b9-4eb7-40ca-aac3-1a8de7e5e04d': {
                title: 'The Party',
                description: 'We drove an hour just to leave in the first 5 minutes and I still think it was rude but I was outvoted.',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: true
            },
			
			'7732435f-f976-4325-8360-fd23d1a62dfc': {
                title: 'Crying, Laughing, Loving, Lying',
                description: 'A love story without any words. Inspired by the works of the great Labi Siffre, go stream their songs and check out their poems if you want to cry.',
                collection: 'dc',
                views: 297,
                uploadDate: '2020-05-20',
                featured: true
            },
			
			'6b9524b0-73a9-4c27-b876-7e7acb8215a6': {
                title: 'The Known Horror',
                description: 'Shot this on my last night in the original Marvins Marvelous Mechanical Museum location. Quite an eerie finale but hey thats how I was feeling... still am :(',
                collection: 'dc',
                views: 297,
                uploadDate: '2020-05-20',
                featured: true
            },
			
			'a4101dfc-a4fa-4cdb-beb1-bfcb9eda3524': {
                title: 'Marvelous Marvins Fabulous Funeral',
                description: 'Its crazy how the death of something so beautiful can bring together so many wonderful people. Visit the new Marvins Marvelous Mechanical Museum location when it opens and stream Tally Hall ASAP!',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'0838f0d4-f253-493a-929d-0ac50cc5ce62': {
                title: 'The Wedding Video',
                description: 'The best night of my life and I wasnt even the one getting married. 30 minutes will go by in a flash I guarentee it just push play already.',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: true
            },
			
			'd249b325-1811-46ba-b4e0-66e0148cfcea': {
                title: 'The Wedding Video: Official Trailer',
                description: 'Watch the trailer and if it doesnt make you wanna watch the full film I owe you 20 bucks, scouts honor.',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'544c51d4-e95a-457b-b3e6-8414e54fc825': {
                title: 'The Doorway Confessional',
                description: 'Sometimes words are best left unspoken. Dont ask how he put together the lego roses with beer bottles taped to his hands.',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'd0520391-aae4-4773-b0de-39e03ab95f65': {
                title: 'The Poodle: Blooper Reel',
                description: 'Its hard to keep it together when youre covered in grease and fake tattoos while screaming about fake food orders. You can watch in real time how we slowly start to hate each other over the course of 3 long shooting days but its all peace and love now.',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'95168688-e025-41b1-995e-f2e6262e5ccf': {
                title: 'The Poodle',
                description: ' Its not just The Bear with pet food orders its so much more.',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: true
            },
			
			'8979c158-d45b-43f5-a523-b88b293a4e20': {
                title: 'Will and Maryannas Chicago Adventure',
                description: 'The first weekend she spent with me in Chicago so how was I not going to document it. I hope we are not too corny.',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'b96708be-dfae-4874-a6b8-c781a1c240db': {
                title: 'Print Shop of Horrors',
                description: 'Took my workplace and turned it into a nightmare and it wasnt even that hard. I had a really fun time writing this and may have gotten a bit carried away, printers have a scary vibe after working with them 24/7. Also no I have not done salvia although I was tempted to method act.',
                collection: 'fs',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			
			
			'25db62b2-9997-422c-ad60-cd2c273e3597': {
                title: 'Lighting Excersise: Mock Road Trip',
                description: 'My professor brought his car on the dound stage just so we could rig up a night driving scene, what a guy. I had fun moving two flashlights around in the back to simulate headlights, pretty curcial role.',
                collection: 'l2',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'047a17b8-cb48-4703-a2b2-4d0f0dc8bb53': {
                title: 'Lighting Excersise: La La Land Dimmer',
                description: 'Who doesnt love a whimsical lighting change. Its also crazy how just adding christmas lights can make a set look so much better. Shout out to Ashley on the keys.',
                collection: 'l2',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'9a7b5029-591f-4dff-baff-496c28e009a7': {
                title: 'Lighting Excersise: Malcom and the Middle Spotlight',
                description: 'Homage to one of the best shows to ever do it. Didnt know when I asked to be a stand in I would be getting my dreams crushed but thats just where the scene took her I guess :(',
                collection: 'l2',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'f7720378-b853-4700-ba78-40faf50d50b0': {
                title: 'Lighting Excersise: Alone in the Club',
                description: 'In the club thinking about how cozy your bed would be at home watching love island #relatable',
                collection: 'l2',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'8485ee53-84d1-42b9-9442-eceb0b342c6e': {
                title: 'Lighting Excersise: DMX Euphoria',
                description: 'Who doesnt love a party with only 3 people because that was the max amount of actors we could have in the scene. Thank god Jerry made a cameo or we wouldve been cooked.',
                collection: 'l2',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'ad14ccaa-6ac2-44a3-9568-9bcef046ffab': {
                title: 'Lighting Excersise: Mood Switch',
                description: 'When youre on a date and he doesnt order bread for the table.',
                collection: 'l2',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'576d3e4a-6fdf-4903-91ca-fdbaf634f1c4': {
                title: 'OMNIPRESENT',
                description: 'Fun lil campy horror short that we filmed over a weekend for a Film 220 class. Shot in my apartment of course and we got a note that it read as "toxic man" instead of "sweet girl" which I was somewhat offended by.',
                collection: 'fs',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'1475ac8e-37fa-48fb-8ebd-2445bb3ddbcc': {
                title: 'Will Bowen Zanies Comedy Set',
                description: 'The coolest final ever and yes I did have to take a stand up comedy class to perform it, the jokes write themselves. Honestly one of the most nervewracking but exciting experiences of my life. My professor chose me to headline no big deal. Sadly based on an entirely true story.',
                collection: 'fs',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'645a3b97-ff58-467e-96f8-f7b15ded2e00': {
                title: 'Affleck Devouring His Son',
                description: 'I was given the task to create a soundscape from an image by my sound design professor and I chose this paparrazzi pic of Ben Affleck. Theres something about it thats just off to me. There actually is a story to it if you can piece it together, be warned its pretty dark.',
                collection: 'fs',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'9c984152-5990-4373-ab96-a391b6bdbae8': {
                title: 'Small Worlds',
                description: 'My best attempt to show off the beauty of the underappreciated miniature room in the basement of the Chicago Art Institute. I mustve looked insane trying to make a makeshift darkroom with my coat to cancel out the reflections idk how I didnt get kickded out.',
                collection: 'fs',
                views: 297,
                uploadDate: '2022-05-20',
                featured: false
            },
			
			'b201fb16-91ed-41cd-8c2e-6df0673f5d12': {
                title: 'Rock Bottom',
                description: 'It started as a joke and then somehow I actually got attached to this rock. Still have it to this day. One of my first times really exploring the city and I did it with an inanimate object, no its not sad.',
                collection: 'fs',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
            'e9ce8e87-763b-48f4-8c70-b19dff16be49': {
                title: 'Bully Maguire VS The Red Line',
                description: 'Learn how to build reusable React components with modern hooks and TypeScript.',
                collection: 'fs',
                views: 1243,
                uploadDate: '2024-12-15',
                featured: false
            },
			
			'b3840759-4bb3-4fb5-818b-4b0e5760c98a': {
                title: 'CTA Parallax Animation',
                description: 'Fun homework assignment for Ani-101. Play it on a loop and pretend like you\'re forever stuck on the best line in all of Chicago!',
                collection: 'fs',
                views: 654,
                uploadDate: '2024-11-20',
                featured: false
            },
            
            'f38ba416-bf6a-4aa8-8a30-b730054621a7': {
                title: 'iPod OG Ad Rotoscope',
                description: 'Rotoscope Assignment for my Ani-101 class. How could I not choose one of the most groovy ad campaigns of all time, I mean it has Daft Punk cmon.',
                collection: 'fs',
                views: 892,
                uploadDate: '2024-12-10',
                featured: false
            },
			
			'97329369-addd-4973-9ca4-1c72102c112d': {
                title: 'Mothers in Mourning Sizzle Reel',
                description: 'A sizzle reel I edited for a spec script about the tragic death of a young black man at the hands of racist police. Really love the assortment of clips I found to personify the script.',
                collection: 'fs',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'7c27b924-9d04-41ae-8b8d-5c4baf2318de': {
                title: 'WALTER & ME',
                description: 'A little backstory here. This was the final for my FILM 101 course and we had to use all the dialogue given to us but it was so bad we decided to make it an inside joke and make him an alien then add our own bit at the end. So effing meta.',
                collection: 'fs',
                views: 297,
                uploadDate: '2021-08-20',
                featured: false
            },
			
			'283437d7-00a1-451d-855c-7c7ee09f7c81': {
                title: 'Until Further Notice',
                description: 'An assignment that I did for my DOC 101 class and one of my favorite mini documentary subjects. My senior year ending abruptly due to a pandemic and th eyears that followed were some of the hardest of my life and it was very healing to put it into film. Shoutout to my Mom who was a frontline Emergency Medicine doctor, the real heroes.',
                collection: 'fs',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'69423eab-8016-4cab-8d7e-08f2bed3876f': {
                title: 'The Gang Commits Voter Fraud',
                description: 'One of my favorite scenes from Its Always Sunny in Philidelphia and it couldnt have fit more perfectly than the 2020 election. Watch the original here https://youtu.be/1NBfZcNU4O0?si=vPKrlFGtQiU7p1vS and tell me how I did.',
                collection: 'whm',
                views: 297,
                uploadDate: '2020-05-20',
                featured: false
            },
			
			'1a31b795-264b-405d-bd5e-3beccd7a89f2': {
                title: 'Does Everyone Have a Valentine at WBHS?',
                description: 'I play cupid and make sure no one is left out on this amazing holiday, but I couldnt save them all :(',
                collection: 'lu',
                views: 297,
                uploadDate: '2020-02-13',
                featured: false
            },
			
			'bbde9256-6dc2-4131-ab39-fd962a9bbfe4': {
                title: 'Do teenagers Still Follow Snow Day Traditions?',
                description: 'Im willing to do whatever it takes to get a day off school but it appears my classmates didnt have what it takes.',
                collection: 'lu',
                views: 297,
                uploadDate: '2020-02-06',
                featured: false
            },
			
			'573499c2-e630-4dd0-b3fd-b22bf0cf45db': {
                title: 'Are High School Dress Codes too Strict?',
                description: 'I stood in solidarity with all my girlies who got dress coded for no reason and somehow didnt get in trouble for this. F the Patriarchy.',
                collection: 'lu',
                views: 297,
                uploadDate: '2020-02-03',
                featured: false
            },
			
			'5c84f875-cd15-4712-b98c-5ef495c0d562': {
                title: 'Is there a Corona-virus Outbreak at WBHS?',
                description: 'Made almost 3 months before school shut down and I lost my senior year. I tried to warn them...',
                collection: 'lu',
                views: 297,
                uploadDate: '2020-01-20',
                featured: false
            },
			
			'49b6239d-0ab3-40d3-8cc8-a6d136444707': {
                title: 'Does Anybody Read The School Newspaper?',
                description: 'A video that swiftly ended the feud between the our school newpaper and the live news team, and also almost got me expelled. The lore of this video goes so deep but just so you know the newspaper club made us work on the weekends for a club we werent even apart of so they deserved it.',
                collection: 'lu',
                views: 297,
                uploadDate: '2020-01-17',
                featured: false
            },
			
			'c58d9c9c-dd38-4649-b607-42ed8bc5bdc8': {
                title: 'Are Teenagers Ready for the Draft?',
                description: 'A bit sensationalist but hey what political commentary isnt right? Thankfully we didnt need to ship out for WW3... yet.',
                collection: 'lu',
                views: 297,
                uploadDate: '2020-01-11',
                featured: false
            },
			
			'6487da88-6764-4bfa-afa5-ba0ca58703ac': {
                title: 'Do High Schoolers Still Believe in Santa?',
                description: 'I tried desperately to spread christmas cheer by interviewing loud for all to hear but I still got coal :(',
                collection: 'lu',
                views: 297,
                uploadDate: '2019-12-19',
                featured: false
            },
			
			'66471047-e1a2-4148-9e39-fb2366c7d24b': {
                title: 'Do Short People Face Discrimination at WBHS?',
                description: 'This whole video was just a ploy to roll around in a chair during class and it worked perfectly.',
                collection: 'lu',
                views: 1456,
                uploadDate: '2019-12-09',
                featured: false
            },
			
			  'cb5672f4-1437-4dbd-97e1-f41da5431586': {
                title: 'Is Mr Watson Leaving WBHS?',
                description: 'He transfered two months later...',
                collection: 'lu',
                views: 734,
                uploadDate: '2019-11-19',
                featured: false
            },
			
			 '19a6cf39-f345-4b03-92a9-3466fdddc186': {
                title: 'Is Tik Tok Taking Over WBHS?',
                description: 'I couldnt stop it... no one could',
                collection: 'lu',
                views: 567,
                uploadDate: '2019-01-07',
                featured: false
            },
			
			//ORIGIN STORY
			
			'938381a4-aeee-4e04-81bc-b4e39cbc3a9a': {
                title: 'NO NOTIFICATIONS',
                description: 'I am embarrassed to admit I made this in high school, I stand by the premise though. At least I almost got that match cut right!',
                collection: 'og',
                views: 297,
                uploadDate: '2015-8-11',
                featured: false
            },
			
			'd3c12dde-a038-4193-9772-6a92f9de7de2': {
                title: 'No Way Out',
                description: 'Jumping up to High School this is what I would call my first short film. Holds a special place in my heart',
                collection: 'og',
                views: 297,
                uploadDate: '2015-6-24',
                featured: false
            },
			
			'1d5c887a-2f03-4d31-9a48-6af4212afa12': {
                title: 'Why Nerds Dont Talk To Girls',
                description: 'A cousins sleepover tunred into a film shoot when I realized I could make an ensebmle piece about a topic close to my heart. Make sure to stay for the post credits blooper reel.',
                collection: 'og',
                views: 297,
                uploadDate: '2012-9-04',
                featured: false
            },
			
			'ccc405ee-6a5d-4950-873d-7fd9fdbbb392': {
                title: 'Talk Time With William Bowen 2',
                description: '2 Talk 2 William Bowen. The sequel that everybody was asking for and a prime example not to fly too close to the sun. Was torn about by critics but loved by my mom.',
                collection: 'og',
                views: 297,
                uploadDate: '2012-7-13',
                featured: false
            },
			
			'348e2c73-f21f-40cc-a6d5-dec0b2ce6e94': {
                title: 'Talk Time With William Bowen',
                description: 'Technically the first film I ever made but I secretly copied the idea from a book I read. The sketches were original though but idk if that helps. Its cute though right?',
                collection: 'og',
                views: 297,
                uploadDate: '2012-6-25',
                featured: false
            },
			
        };

        // ============================================
        // HLS URL GENERATORS
        // ============================================
        
        /**
         * Generate Bunny CDN HLS URL
         */
        function getBunnyHLSUrl(videoId) {
            return `${BUNNY_CONFIG.baseUrl}/${videoId}/playlist.m3u8`;
        }

        /**
         * Generate Bunny CDN thumbnail URL
         */
        function getBunnyThumbnailUrl(videoId) {
            return `${BUNNY_CONFIG.baseUrl}/${videoId}/thumbnail.jpg`;
        }

        /**
         * Get video metadata with generated URLs
         */
        function getVideoData(videoId) {
            const video = VIDEO_DATABASE[videoId];
            if (!video) return null;
            
            return {
                id: videoId,
                ...video,
                thumbnailUrl: getBunnyThumbnailUrl(videoId),
                hlsUrl: getBunnyHLSUrl(videoId)
            };
        }

        // ============================================
        // EASY VIDEO MANAGEMENT FUNCTIONS
        // ============================================
        
        /**
         * Add a new video to the database
         */
        function addVideo(videoId, metadata) {
            VIDEO_DATABASE[videoId] = {
                featured: false,
                views: 0,
                uploadDate: new Date().toISOString().split('T')[0],
                ...metadata
            };
            
            // Refresh the page content
            initializePage();
        }

        /**
         * Set featured videos (max 4)
         */
        function setFeaturedVideos(videoIds) {
            // Reset all featured status
            Object.keys(VIDEO_DATABASE).forEach(id => {
                VIDEO_DATABASE[id].featured = false;
            });
            
            // Set new featured videos
            videoIds.slice(0, 5).forEach(id => {
                if (VIDEO_DATABASE[id]) {
                    VIDEO_DATABASE[id].featured = true;
                }
            });
            
            // Refresh featured section
            populateFeaturedVideos();
        }

        /**
         * Get videos by collection
         */
        function getVideosByCollection(collection) {
            return Object.keys(VIDEO_DATABASE)
                .filter(id => VIDEO_DATABASE[id].collection === collection)
                .map(id => getVideoData(id))
                .filter(video => video !== null);
        }

        /**
         * Get featured videos
         */
        function getFeaturedVideos() {
            return Object.keys(VIDEO_DATABASE)
                .filter(id => VIDEO_DATABASE[id].featured)
                .map(id => getVideoData(id))
                .filter(video => video !== null)
                .slice(0, 5);
        }

        // ============================================
        // HLS PLAYER SETUP AND MANAGEMENT
        // ============================================
        
        /**
         * Initialize HLS player with quality control
         */
        function initializeHLSPlayer(hlsUrl) {
            const video = document.getElementById('mainPlayer');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            // Show loading spinner
            loadingSpinner.style.display = 'block';
            
            // Destroy existing HLS instance
            if (hlsInstance) {
                hlsInstance.destroy();
                hlsInstance = null;
            }

            // Check for native HLS support
            if (video.canPlayType('application/vnd.apple.mpegurl')) {
                // Native HLS support (Safari, iOS)
                video.src = hlsUrl;
                setupNativeHLSQualityControl(video);
            } else if (Hls.isSupported()) {
                // Use HLS.js for other browsers
                hlsInstance = new Hls({
                    enableWorker: true,
                    lowLatencyMode: false,
                    backBufferLength: 90
                });
                
                hlsInstance.loadSource(hlsUrl);
                hlsInstance.attachMedia(video);
                
               hlsInstance.on(Hls.Events.MANIFEST_PARSED, function(event, data) {
    console.log('HLS manifest loaded, found ' + data.levels.length + ' quality levels');
    
    // Set to highest quality (last level in array)
    const highestQualityIndex = data.levels.length - 1;
    hlsInstance.currentLevel = highestQualityIndex;
    
    // Update UI to show highest quality
    const highestLevel = data.levels[highestQualityIndex];
    updateCurrentQuality(highestLevel);
    
    populateQualityDropdown(data.levels);
    
    // Update dropdown to show highest as active
    setTimeout(() => {
        const qualityOptions = document.querySelectorAll('.quality-option');
        qualityOptions.forEach(option => option.classList.remove('active'));
        if (qualityOptions[highestQualityIndex + 1]) { // +1 because auto is first
            qualityOptions[highestQualityIndex + 1].classList.add('active');
        }
    }, 100);
    
    loadingSpinner.style.display = 'none';
});
                
                hlsInstance.on(Hls.Events.LEVEL_SWITCHED, function(event, data) {
                    const level = hlsInstance.levels[data.level];
                    updateCurrentQuality(level);
                });
                
                hlsInstance.on(Hls.Events.ERROR, function(event, data) {
                    console.error('HLS error:', data);
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                console.log('Network error, trying to recover...');
                                hlsInstance.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                console.log('Media error, trying to recover...');
                                hlsInstance.recoverMediaError();
                                break;
                            default:
                                hlsInstance.destroy();
                                loadingSpinner.style.display = 'none';
                                break;
                        }
                    }
                });
            } else {
                console.error('HLS is not supported in this browser');
                loadingSpinner.style.display = 'none';
                alert('Your browser does not support HLS video playback. Please try a modern browser.');
                return;
            }

            // Setup common video events
            video.addEventListener('loadstart', function() {
                loadingSpinner.style.display = 'block';
            });

            video.addEventListener('canplay', function() {
                loadingSpinner.style.display = 'none';
            });

            video.addEventListener('waiting', function() {
                loadingSpinner.style.display = 'block';
            });

            video.addEventListener('playing', function() {
                loadingSpinner.style.display = 'none';
            });
        }

        /**
         * Setup quality control for native HLS (Safari)
         */
        function setupNativeHLSQualityControl(video) {
            // For native HLS, we can't easily access quality levels
            // Show a simplified quality selector
            const qualityDropdown = document.getElementById('qualityDropdown');
            qualityDropdown.innerHTML = '<div class="quality-option active">Auto</div>';
            document.getElementById('currentQuality').textContent = 'Auto';
        }

        /**
         * Populate quality dropdown with available levels
         */
        function populateQualityDropdown(levels) {
            const qualityDropdown = document.getElementById('qualityDropdown');
            qualityDropdown.innerHTML = '';

            // Add auto quality option
            const autoOption = document.createElement('div');
            autoOption.className = 'quality-option active';
            autoOption.textContent = 'Auto';
            autoOption.onclick = () => setQuality(-1);
            qualityDropdown.appendChild(autoOption);

            // Add manual quality options
            levels.forEach((level, index) => {
                const option = document.createElement('div');
                option.className = 'quality-option';
                
                // Format quality label
                const height = level.height;
                let qualityLabel = height + 'p';
                if (height >= 2160) qualityLabel = '4K';
                else if (height >= 1440) qualityLabel = '1440p';
                else if (height >= 1080) qualityLabel = '1080p';
                else if (height >= 720) qualityLabel = '720p';
                else if (height >= 480) qualityLabel = '480p';
                
                option.textContent = qualityLabel;
                option.onclick = () => setQuality(index);
                qualityDropdown.appendChild(option);
            });
        }

        /**
         * Set video quality
         */
        function setQuality(levelIndex) {
            if (!hlsInstance) return;

            const qualityOptions = document.querySelectorAll('.quality-option');
            qualityOptions.forEach(option => option.classList.remove('active'));

            if (levelIndex === -1) {
                // Auto quality
                hlsInstance.currentLevel = -1;
                document.getElementById('currentQuality').textContent = 'Auto';
                qualityOptions[0].classList.add('active');
            } else {
                // Manual quality
                hlsInstance.currentLevel = levelIndex;
                const level = hlsInstance.levels[levelIndex];
                updateCurrentQuality(level);
                qualityOptions[levelIndex + 1].classList.add('active');
            }

            // Hide dropdown
            document.getElementById('qualityDropdown').style.display = 'none';
        }

        /**
         * Update current quality display
         */
        function updateCurrentQuality(level) {
            const height = level.height;
            let qualityLabel = height + 'p';
            if (height >= 2160) qualityLabel = '4K';
            else if (height >= 1440) qualityLabel = '1440p';
            else if (height >= 1080) qualityLabel = '1080p';
            else if (height >= 720) qualityLabel = '720p';
            else if (height >= 480) qualityLabel = '480p';
            
            document.getElementById('currentQuality').textContent = qualityLabel;
        }

        /**
         * Toggle quality dropdown visibility
         */
        function toggleQualityDropdown() {
            const dropdown = document.getElementById('qualityDropdown');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }

        // Close quality dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const qualitySelector = document.querySelector('.quality-selector');
            const dropdown = document.getElementById('qualityDropdown');
            
            if (!qualitySelector.contains(event.target)) {
                dropdown.style.display = 'none';
            }
        });

        // ============================================
        // DISPLAY FUNCTIONS
        // ============================================
        
        /**
         * Populate featured videos section
         */
        function populateFeaturedVideos() {
            const featuredContainer = document.getElementById('featuredVideos');
            const featuredVideos = getFeaturedVideos();
            
            featuredContainer.innerHTML = '';
            
            featuredVideos.forEach(video => {
                const featuredDiv = document.createElement('div');
                featuredDiv.className = 'featured-video';
                featuredDiv.onclick = () => playVideo(video.id);
                
                featuredDiv.innerHTML = `
                    <div class="featured-thumbnail">
                        <img src="${video.thumbnailUrl}" alt="${video.title}" 
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQwIiBoZWlnaHQ9IjEwNSIgdmlld0JveD0iMCAwIDE0MCAxMDUiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNDAiIGhlaWdodD0iMTA1IiBmaWxsPSIjY2NjY2NjIi8+Cjx0ZXh0IHg9IjcwIiB5PSI1MiIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmaWxsPSIjNjY2NjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+VmlkZW88L3RleHQ+Cjwvc3ZnPg=='">
                    </div>
                    <div class="featured-title">${video.title}</div>
                    <div class="featured-info">Added: ${formatDate(video.uploadDate)}<br>Views: ${video.views.toLocaleString()}</div>
                `;
                
                featuredContainer.appendChild(featuredDiv);
            });
        }

        /**
         * Populate category filters
         */
        function populateCategoryFilters() {
            const filtersContainer = document.getElementById('categoryFilters');
            filtersContainer.innerHTML = '';
            
            // Add "All Videos" button
            const allButton = document.createElement('div');
            allButton.className = 'category-button active';
            allButton.textContent = 'All Videos';
            allButton.onclick = () => filterByCategory('all');
            filtersContainer.appendChild(allButton);
            
            // Add collection buttons
            Object.keys(COLLECTIONS).forEach(collectionKey => {
                const collection = COLLECTIONS[collectionKey];
                const button = document.createElement('div');
                button.className = 'category-button';
                button.textContent = collection.name;
                button.onclick = () => filterByCategory(collectionKey);
                filtersContainer.appendChild(button);
            });
        }

        /**
         * Populate video gallery
         */
        function populateVideoGallery() {
            const gridContainer = document.getElementById('videoGrid');
            gridContainer.innerHTML = '';
            
            Object.keys(VIDEO_DATABASE).forEach(videoId => {
                const video = getVideoData(videoId);
                if (!video) return;
                
                const videoDiv = document.createElement('div');
                videoDiv.className = 'video-item';
                videoDiv.setAttribute('data-category', video.collection);
                videoDiv.onclick = () => playVideo(video.id);
                
                videoDiv.innerHTML = `
                    <div class="video-thumbnail">
                        <img src="${video.thumbnailUrl}" alt="${video.title}"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDIwMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIyMDAiIGhlaWdodD0iMTIwIiBmaWxsPSIjY2NjY2NjIi8+Cjx0ZXh0IHg9IjEwMCIgeT0iNjAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzY2NjY2NiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pgo8L3N2Zz4='">
                    </div>
                    <div class="video-info">
                        <h4>${video.title}</h4>
                        <div class="video-description">${video.description}</div>
                        <div class="video-meta">Views: ${video.views.toLocaleString()} | ${formatDate(video.uploadDate)} | HLS</div>
                        <div class="category-tag">${COLLECTIONS[video.collection]?.name || 'General'}</div>
                    </div>
                `;
                
                gridContainer.appendChild(videoDiv);
            });
        }

        // ============================================
        // VIDEO PLAYER FUNCTIONS
        // ============================================
        
        /**
         * Play video using HLS
         */
        async function playVideo(videoId) {
            const video = getVideoData(videoId);
            if (!video) {
                console.error('Video not found:', videoId);
                return;
            }

            const playerSection = document.getElementById('playerSection');
            const mainPlayer = document.getElementById('mainPlayer');
            const currentTitle = document.getElementById('currentTitle');
            const currentDescription = document.getElementById('currentDescription');
            const currentStats = document.getElementById('currentStats');

            // Store current video ID
            currentVideoId = videoId;

            // Update player info
            currentTitle.textContent = video.title;
            currentDescription.textContent = video.description;
            currentStats.textContent = `Views: ${video.views.toLocaleString()} | Added: ${formatDate(video.uploadDate)} | HLS Streaming`;
            
            // Show player section
            playerSection.style.display = 'block';
            
            // Hide native controls and use custom ones
            mainPlayer.controls = false;
            
            // Initialize HLS player
            initializeHLSPlayer(video.hlsUrl);
            
            // Setup custom controls
            setupCustomControls();
            
            // Auto-play when video is ready
            mainPlayer.addEventListener('canplay', function() {
                mainPlayer.play().catch(function(error) {
                    console.log('Autoplay prevented by browser:', error);
                    // Autoplay was prevented, user will need to click play
                });
            }, { once: true }); // Only run once per video load
            
            // Increment view count
            VIDEO_DATABASE[videoId].views++;
            
            // Scroll to player
            playerSection.scrollIntoView({ behavior: 'smooth', block: 'start' });

            await loadVideoRatingData(videoId);
            updateRatingDisplay();
            updateCommentsDisplay();
            resetUserRatingStars();
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        /**
         * Format date for display
         */
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        /**
         * Filter videos by category
         */
function filterByCategory(category) {
    const videoItems = document.querySelectorAll('.video-item');
    const categoryButtons = document.querySelectorAll('.category-button');
    const categoryText = document.getElementById('categoryText');
    
    // Update active button
    categoryButtons.forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    
    // Update description based on category
    if (category === 'all') {
        categoryText.textContent = 'Browse through all videos in Will\'s collection. Use the category filters above to narrow down by specific collections.';
    } else if (COLLECTIONS[category]) {
        categoryText.textContent = COLLECTIONS[category].description;
    }
    
    // Filter videos
    videoItems.forEach(item => {
        const itemCategory = item.getAttribute('data-category');
        if (category === 'all' || itemCategory === category) {
            item.classList.remove('hidden');
        } else {
            item.classList.add('hidden');
        }
    });
            
            // Update search if there's an active search term
  const searchTerm = document.getElementById('searchInput').value.toLowerCase();
    if (searchTerm) {
        searchVideos();
    }
}

        /**
         * Search videos
         */
        function searchVideos() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const videoItems = document.querySelectorAll('.video-item');
            const activeCategory = document.querySelector('.category-button.active').textContent.toLowerCase();
            
            videoItems.forEach(item => {
                const title = item.querySelector('h4').textContent.toLowerCase();
                const description = item.querySelector('.video-description').textContent.toLowerCase();
                const itemCategory = item.getAttribute('data-category');
                
                const matchesSearch = title.includes(searchTerm) || description.includes(searchTerm);
                const matchesCategory = activeCategory === 'all videos' || itemCategory === getCategoryKeyFromName(activeCategory);
                
                if (matchesSearch && matchesCategory) {
                    item.classList.remove('hidden');
                } else {
                    item.classList.add('hidden');
                }
            });

            // Scroll to results on mobile after search
            if (window.innerWidth <= 768 && searchTerm) {
                document.querySelector('.gallery-section').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }
        }

        /**
         * Get category key from display name
         */
        function getCategoryKeyFromName(name) {
            for (let key in COLLECTIONS) {
                if (COLLECTIONS[key].name.toLowerCase() === name) {
                    return key;
                }
            }
            return null;
        }

        // ============================================
        // CUSTOM VIDEO CONTROLS - FIXED PROGRESS BAR
        // ============================================
        
        function setupCustomControls() {
            const video = document.getElementById('mainPlayer');
            const playPauseBtn = document.getElementById('playPauseBtn');
            const progressBar = document.getElementById('progressBar');
            const currentTimeDisplay = document.getElementById('currentTime');
            const durationDisplay = document.getElementById('duration');
            const volumeBar = document.getElementById('volumeBar');
            const bufferBar = document.getElementById('bufferBar');
            const loadingSpinner = document.getElementById('loadingSpinner');

            // Update time displays
            video.addEventListener('loadedmetadata', function() {
                durationDisplay.textContent = formatTime(video.duration);
                loadingSpinner.style.display = 'none';
            });

            video.addEventListener('timeupdate', function() {
                const progress = (video.currentTime / video.duration) * 100;
                progressBar.style.width = progress + '%';
                currentTimeDisplay.textContent = formatTime(video.currentTime);
            });

            video.addEventListener('progress', function() {
                if (video.buffered.length > 0) {
                    const buffered = (video.buffered.end(0) / video.duration) * 100;
                    bufferBar.style.width = buffered + '%';
                }
            });

            video.addEventListener('waiting', function() {
                loadingSpinner.style.display = 'block';
            });

            video.addEventListener('canplay', function() {
                loadingSpinner.style.display = 'none';
            });

            video.addEventListener('play', function() {
                playPauseBtn.textContent = 'â¸';
            });

            video.addEventListener('pause', function() {
                playPauseBtn.textContent = 'â–¶';
            });
        }

        function togglePlayPause() {
            const video = document.getElementById('mainPlayer');
            if (video.paused) {
                video.play();
            } else {
                video.pause();
            }
        }

        function stopVideo() {
            const video = document.getElementById('mainPlayer');
            video.pause();
            video.currentTime = 0;
            document.getElementById('playPauseBtn').textContent = 'â–¶';
        }

        // FIXED SEEK FUNCTION - FROM WORKING VERSION
        function seekVideo(event) {
            const video = document.getElementById('mainPlayer');
            const progressContainer = event.currentTarget;
            const rect = progressContainer.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            video.currentTime = percent * video.duration;
        }

        function toggleMute() {
            const video = document.getElementById('mainPlayer');
            const volumeIcon = event.currentTarget;
            video.muted = !video.muted;
            volumeIcon.textContent = video.muted ? 'ðŸ”‡' : 'ðŸ”Š';
        }

        function setVolume(event) {
            const video = document.getElementById('mainPlayer');
            const volumeSlider = event.currentTarget;
            const rect = volumeSlider.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            video.volume = percent;
            document.getElementById('volumeBar').style.width = (percent * 100) + '%';
        }

        function toggleFullscreen() {
            const video = document.getElementById('mainPlayer');
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                video.requestFullscreen();
            }
        }

        function formatTime(seconds) {
            if (isNaN(seconds) || seconds < 0) return '00:00';
            
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            
            // For videos longer than an hour, show hours
            if (seconds >= 3600) {
                const hours = Math.floor(seconds / 3600);
                const remainingMins = Math.floor((seconds % 3600) / 60);
                return hours + ':' + (remainingMins < 10 ? '0' : '') + remainingMins + ':' + (secs < 10 ? '0' : '') + secs;
            }
            
            // For videos under an hour, just show minutes:seconds
            return (mins < 10 ? '0' : '') + mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        // ============================================
        // ACTION BUTTON FUNCTIONS
        // ============================================
        
        function shareVideo() {
            const currentTitle = document.getElementById('currentTitle').textContent;
            if (navigator.share) {
                navigator.share({
                    title: currentTitle,
                    url: window.location.href
                });
            } else {
                navigator.clipboard.writeText(window.location.href);
                alert('Video link copied to clipboard!');
            }
        }

        function toggleFavorite() {
            alert('Added to favorites! (Feature coming soon)');
        }

        function downloadVideo() {
            if (currentVideoId) {
                const video = getVideoData(currentVideoId);
                if (video) {
                    // For HLS streams, we can't directly download
                    // Instead, provide the HLS URL for external download tools
                    const downloadInfo = `To download this video, use an HLS-compatible downloader with this URL:\n\n${video.hlsUrl}`;
                    
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(video.hlsUrl);
                        alert('HLS URL copied to clipboard! Use an HLS downloader tool to save this video.');
                    } else {
                        alert(downloadInfo);
                    }
                }
            }
        }

        // ============================================
        // MOBILE OPTIMIZATIONS
        // ============================================
        
        function handleMobileControls() {
            if (window.innerWidth <= 768) {
                const retroControls = document.getElementById('retroControls');
                if (retroControls) {
                    retroControls.style.opacity = '1';
                }

                const progressContainer = document.querySelector('.progress-container');
                const volumeSlider = document.querySelector('.volume-slider');

                if (progressContainer) {
                    progressContainer.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        const touch = e.touches[0];
                        const rect = this.getBoundingClientRect();
                        const percent = (touch.clientX - rect.left) / rect.width;
                        const video = document.getElementById('mainPlayer');
                        if (video) {
                            video.currentTime = percent * video.duration;
                        }
                    });
                }

                if (volumeSlider) {
                    volumeSlider.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        const touch = e.touches[0];
                        const rect = this.getBoundingClientRect();
                        const percent = (touch.clientX - rect.left) / rect.width;
                        const video = document.getElementById('mainPlayer');
                        if (video) {
                            video.volume = percent;
                            document.getElementById('volumeBar').style.width = (percent * 100) + '%';
                        }
                    });
                }
            }
        }

        // ============================================
        // KEYBOARD SHORTCUTS
        // ============================================
        
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(event) {
                const video = document.getElementById('mainPlayer');
                const playerSection = document.getElementById('playerSection');
                
                // Only handle shortcuts if player is visible and focused
                if (playerSection.style.display === 'none') return;
                
                switch(event.code) {
                    case 'Space':
                        event.preventDefault();
                        togglePlayPause();
                        break;
                    case 'ArrowLeft':
                        event.preventDefault();
                        video.currentTime = Math.max(0, video.currentTime - 10);
                        break;
                    case 'ArrowRight':
                        event.preventDefault();
                        video.currentTime = Math.min(video.duration, video.currentTime + 10);
                        break;
                    case 'ArrowUp':
                        event.preventDefault();
                        video.volume = Math.min(1, video.volume + 0.1);
                        document.getElementById('volumeBar').style.width = (video.volume * 100) + '%';
                        break;
                    case 'ArrowDown':
                        event.preventDefault();
                        video.volume = Math.max(0, video.volume - 0.1);
                        document.getElementById('volumeBar').style.width = (video.volume * 100) + '%';
                        break;
                    case 'KeyF':
                        event.preventDefault();
                        toggleFullscreen();
                        break;
                    case 'KeyM':
                        event.preventDefault();
                        toggleMute();
                        break;
                }
            });
        }

const API_BASE = 'https://comment-server-cuos.onrender.com/api';
// Rating & Comment System Variables
let userCurrentRating = 0;
let selectedAvatarIndex = 0;
let currentAvatarPage = 0;
let allAvatars = [];
let videoRatingData = {
    ratings: { total: 0, sum: 0, average: 0 },
    comments: []
};
// ============================================
// AVATAR SYSTEM
// ============================================


function createAvatarRow() {
    const avatarRow = document.getElementById('avatarRow');
    if (!avatarRow) return;
    
    allAvatars = [];
    
    const colors = [
        'linear-gradient(135deg, #4080ff, #2060df)',
        'linear-gradient(135deg, #ff4080, #df2060)',
        'linear-gradient(135deg, #80ff40, #60df20)',
        'linear-gradient(135deg, #ff8040, #df6020)',
        'linear-gradient(135deg, #8040ff, #6020df)',
        'linear-gradient(135deg, #40ff80, #20df60)',
        'linear-gradient(135deg, #ff4040, #df2020)',
        'linear-gradient(135deg, #4040ff, #2020df)',
        'linear-gradient(135deg, #ff8080, #df6060)',
        'linear-gradient(135deg, #80ff80, #60df60)',
        'linear-gradient(135deg, #8080ff, #6060df)',
        'linear-gradient(135deg, #ffff40, #dfdf20)',
        'linear-gradient(135deg, #ff40ff, #df20df)',
        'linear-gradient(135deg, #40ffff, #20dfdf)',
        'linear-gradient(135deg, #ffaa40, #dfaa20)',
        'linear-gradient(135deg, #aa40ff, #aa20df)',
        'linear-gradient(135deg, #40aaff, #20aadf)',
        'linear-gradient(135deg, #ffaa80, #dfaa60)',
        'linear-gradient(135deg, #aa80ff, #aa60df)',
        'linear-gradient(135deg, #80aaff, #60aadf)',
        'linear-gradient(135deg, #ffccaa, #dfccaa)',
        'linear-gradient(135deg, #aaccff, #aaccdf)',
        'linear-gradient(135deg, #ccaaff, #ccaadf)',
        'linear-gradient(135deg, #ffccff, #dfccdf)',
        'linear-gradient(135deg, #ccffaa, #ccdfaa)',
        'linear-gradient(135deg, #aaffcc, #aadfcc)',
        'linear-gradient(135deg, #ffaacc, #dfaacc)',
        'linear-gradient(135deg, #ccaaaa, #ccaaaa)',
        'linear-gradient(135deg, #aaccaa, #aaccaa)'
    ];
    
    for (let i = 0; i < 29; i++) {
        const avatarDiv = document.createElement('div');
        avatarDiv.className = 'avatar-choice';
        avatarDiv.dataset.index = i;
        
        if (i === 0) {
            avatarDiv.classList.add('selected');
        }
        
        const avatarNumber = i + 1;
        const avatarFile = `avatar${avatarNumber}.png`;
        
        const img = new Image();
        img.onload = function() {
            avatarDiv.style.backgroundImage = `url('avatars/${avatarFile}')`;
            avatarDiv.style.backgroundSize = 'cover';
            avatarDiv.style.backgroundPosition = 'center';
            avatarDiv.textContent = '';
            avatarDiv.style.color = 'transparent';
        };
        
        img.onerror = function() {
            avatarDiv.style.backgroundImage = 'none';
            avatarDiv.style.background = colors[i % colors.length];
            avatarDiv.textContent = String.fromCharCode(65 + (i % 26));
            avatarDiv.style.color = 'white';
            avatarDiv.style.fontSize = '10px';
            avatarDiv.style.fontWeight = 'bold';
        };
        
        img.src = `avatars/${avatarFile}`;
        
        avatarDiv.onclick = function() {
            selectAvatarByIndex(i);
        };
        
        avatarDiv.title = `Avatar ${avatarNumber}`;
        allAvatars.push(avatarDiv);
    }
    
    currentAvatarPage = 0;
    
    // Delay the display update until the DOM is fully rendered
    setTimeout(() => {
        updateAvatarDisplay();
    }, 100);
}

function updateAvatarDisplay() {
    const avatarRow = document.getElementById('avatarRow');
    const prevBtn = document.getElementById('avatarPrev');
    const nextBtn = document.getElementById('avatarNext');
    
    // Calculate how many avatars fit dynamically
    const avatarsPerPage = calculateAvatarsPerPage();
    
    avatarRow.innerHTML = '';
    
    const startIndex = currentAvatarPage * avatarsPerPage;
    const endIndex = Math.min(startIndex + avatarsPerPage, allAvatars.length);
    
    for (let i = startIndex; i < endIndex; i++) {
        avatarRow.appendChild(allAvatars[i]);
    }
    
    if (currentAvatarPage === 0) {
        prevBtn.classList.add('disabled');
    } else {
        prevBtn.classList.remove('disabled');
    }
    
    const maxPage = Math.ceil(allAvatars.length / avatarsPerPage) - 1;
    if (currentAvatarPage >= maxPage) {
        nextBtn.classList.add('disabled');
    } else {
        nextBtn.classList.remove('disabled');
    }
}

function previousAvatarPage() {
    if (currentAvatarPage > 0) {
        currentAvatarPage--;
        updateAvatarDisplay();
    }
}

function nextAvatarPage() {
    const avatarsPerPage = calculateAvatarsPerPage();
    const maxPage = Math.ceil(allAvatars.length / avatarsPerPage) - 1;
    if (currentAvatarPage < maxPage) {
        currentAvatarPage++;
        updateAvatarDisplay();
    }
}

function selectAvatarByIndex(index) {
    selectedAvatarIndex = index;
    
    allAvatars.forEach(avatar => {
        avatar.classList.remove('selected');
    });
    
    allAvatars[index].classList.add('selected');
    
    const avatarsPerPage = calculateAvatarsPerPage();
    const avatarPage = Math.floor(index / avatarsPerPage);
    if (avatarPage !== currentAvatarPage) {
        currentAvatarPage = avatarPage;
        updateAvatarDisplay();
    }
}

function getAvatarForComment(index) {
    const colors = [
        'linear-gradient(135deg, #4080ff, #2060df)',
        'linear-gradient(135deg, #ff4080, #df2060)',
        'linear-gradient(135deg, #80ff40, #60df20)',
        'linear-gradient(135deg, #ff8040, #df6020)',
        'linear-gradient(135deg, #8040ff, #6020df)',
        'linear-gradient(135deg, #40ff80, #20df60)',
        'linear-gradient(135deg, #ff4040, #df2020)',
        'linear-gradient(135deg, #4040ff, #2020df)',
        'linear-gradient(135deg, #ff8080, #df6060)',
        'linear-gradient(135deg, #80ff80, #60df60)',
        'linear-gradient(135deg, #8080ff, #6060df)',
        'linear-gradient(135deg, #ffff40, #dfdf20)',
        'linear-gradient(135deg, #ff40ff, #df20df)',
        'linear-gradient(135deg, #40ffff, #20dfdf)',
        'linear-gradient(135deg, #ffaa40, #dfaa20)',
        'linear-gradient(135deg, #aa40ff, #aa20df)',
        'linear-gradient(135deg, #40aaff, #20aadf)',
        'linear-gradient(135deg, #ffaa80, #dfaa60)',
        'linear-gradient(135deg, #aa80ff, #aa60df)',
        'linear-gradient(135deg, #80aaff, #60aadf)',
        'linear-gradient(135deg, #ffccaa, #dfccaa)',
        'linear-gradient(135deg, #aaccff, #aaccdf)',
        'linear-gradient(135deg, #ccaaff, #ccaadf)',
        'linear-gradient(135deg, #ffccff, #dfccdf)',
        'linear-gradient(135deg, #ccffaa, #ccdfaa)',
        'linear-gradient(135deg, #aaffcc, #aadfcc)',
        'linear-gradient(135deg, #ffaacc, #dfaacc)',
        'linear-gradient(135deg, #ccaaaa, #ccaaaa)',
        'linear-gradient(135deg, #aaccaa, #aaccaa)'
    ];
    
    const avatarNumber = index + 1;
    const avatarFile = `avatar${avatarNumber}.png`;
    
    return {
        avatarFile: avatarFile,
        fallbackBackground: colors[index % colors.length],
        fallbackLetter: String.fromCharCode(65 + (index % 26))
    };
}
function calculateAvatarsPerPage() {
    const avatarNavigation = document.querySelector('.avatar-navigation');
    const avatarRow = document.getElementById('avatarRow');
    const arrows = document.querySelectorAll('.avatar-arrow');
    
    // Check if we're on mobile
    const isMobile = window.innerWidth <= 768;
    
    // Force 4 avatars on mobile, calculate for desktop
    if (isMobile) {
        return 4; // Fixed 4 avatars on mobile
    }
    
    // Desktop calculation (existing logic)
    const defaultWidth = 366;
    const totalWidth = (avatarNavigation && avatarNavigation.offsetWidth > 0) 
        ? avatarNavigation.offsetWidth 
        : defaultWidth;
    
    if (!avatarRow || arrows.length < 2) return 9;
    
    const arrowWidth = arrows.length >= 2 ? arrows[0].offsetWidth * 2 : 40;
    const navigationGaps = 8;
    const availableWidth = totalWidth - arrowWidth - navigationGaps;
    const avatarWidth = 24;
    const avatarGap = 4;
    const avatarsPerPage = Math.floor((availableWidth + avatarGap) / (avatarWidth + avatarGap));
    const result = Math.max(1, Math.min(avatarsPerPage, 29));
    
    return result;
}
// ============================================
// RATING SYSTEM
// ============================================

function updateRatingDisplay() {
    const avgStars = document.getElementById('avgRatingStars');
    const ratingText = document.getElementById('ratingText');
    const ratings = videoRatingData.ratings;

    const avgRating = ratings.average || 0;
    const stars = avgStars.querySelectorAll('.star');
    
    stars.forEach((star, index) => {
        if (index < Math.floor(avgRating)) {
            star.textContent = 'â˜…';
            star.style.color = '#ffd700';
        } else if (index < avgRating) {
            star.textContent = 'â˜…';
            star.style.color = '#ffd700';
            star.style.opacity = '0.5';
        } else {
            star.textContent = 'â˜†';
            star.style.color = '#ddd';
            star.style.opacity = '1';
        }
    });

    if (ratings.total > 0) {
        ratingText.textContent = `${avgRating.toFixed(1)}/5 stars â€¢ ${ratings.total} rating${ratings.total !== 1 ? 's' : ''}`;
    } else {
        ratingText.textContent = 'No ratings yet';
    }
}

function setUserRating(rating) {
    userCurrentRating = rating;
    const userStars = document.getElementById('userRatingStars');
    const stars = userStars.querySelectorAll('.star');
    const submitButton = document.getElementById('submitRating');

    stars.forEach((star, index) => {
        if (index < rating) {
            star.textContent = 'â˜…';
            star.style.color = '#ffd700';
        } else {
            star.textContent = 'â˜†';
            star.style.color = '#ddd';
        }
    });

    submitButton.disabled = false;
}

async function submitRating() {
    if (userCurrentRating === 0 || !currentVideoId) return;

    const submitButton = document.getElementById('submitRating');
    const originalText = submitButton.textContent;
    
    try {
        submitButton.textContent = 'Rating...';
        submitButton.disabled = true;

        const response = await fetch(`${API_BASE}/ratings`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ videoId: currentVideoId, rating: userCurrentRating })
        });
        
        if (response.ok) {
            const result = await response.json();
            videoRatingData.ratings = result.ratings;
            updateRatingDisplay();
            
            submitButton.textContent = 'Rated!';
            setTimeout(() => {
                submitButton.textContent = originalText;
                submitButton.disabled = true;
                userCurrentRating = 0;
                resetUserRatingStars();
            }, 2000);
        } else {
            throw new Error('Failed to submit rating');
        }

    } catch (error) {
        console.error('Rating error:', error);
        submitButton.textContent = originalText;
        submitButton.disabled = false;
    }
}

function resetUserRatingStars() {
    const userStars = document.getElementById('userRatingStars');
    const stars = userStars.querySelectorAll('.star');
    
    stars.forEach(star => {
        star.textContent = 'â˜†';
        star.style.color = '#ddd';
    });
}

// ============================================
// COMMENT SYSTEM
// ============================================

function updateCommentsDisplay() {
    const commentsList = document.getElementById('commentsList');
    const commentsHeader = document.getElementById('commentsHeader');
    const comments = videoRatingData.comments || [];

    commentsHeader.textContent = `Comments (${comments.length})`;
    commentsList.innerHTML = '';

    const sortedComments = [...comments].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

    sortedComments.forEach(comment => {
        const commentDiv = document.createElement('div');
        commentDiv.className = 'comment';
        
        const avatarIndex = comment.avatarIndex || 0;
        const avatarInfo = getAvatarForComment(avatarIndex);
        
        const date = new Date(comment.timestamp).toLocaleString();
        
        const avatarElement = document.createElement('div');
        avatarElement.className = 'comment-avatar';
        
        const img = new Image();
        img.onload = function() {
            avatarElement.style.backgroundImage = `url('avatars/${avatarInfo.avatarFile}')`;
            avatarElement.style.backgroundSize = 'cover';
            avatarElement.style.backgroundPosition = 'center';
            avatarElement.textContent = '';
        };
        img.onerror = function() {
            avatarElement.style.background = avatarInfo.fallbackBackground;
            avatarElement.textContent = avatarInfo.fallbackLetter;
            avatarElement.style.color = 'white';
            avatarElement.style.fontSize = '14px';
            avatarElement.style.fontWeight = 'bold';
            avatarElement.style.display = 'flex';
            avatarElement.style.alignItems = 'center';
            avatarElement.style.justifyContent = 'center';
        };
        img.src = `avatars/${avatarInfo.avatarFile}`;
        
        commentDiv.innerHTML = `
            <div class="comment-content">
                <div class="comment-author">${escapeHtml(comment.author)}</div>
                <div class="comment-text">${escapeHtml(comment.text)}</div>
                <div class="comment-date">${date}</div>
            </div>
        `;
        
        commentDiv.insertBefore(avatarElement, commentDiv.firstChild);
        commentsList.appendChild(commentDiv);
    });

    commentsList.scrollTop = 0;
}

async function submitComment() {
    const nameInput = document.getElementById('commentName');
    const messageInput = document.getElementById('commentMessage');
    const submitButton = document.getElementById('submitComment');
    
    const name = nameInput.value.trim();
    const message = messageInput.value.trim();
    
    if (!name || !message) {
        alert('Please enter both name and message!');
        return;
    }

    if (!currentVideoId) {
        alert('Please select a video first!');
        return;
    }

    const originalText = submitButton.textContent;
    
    try {
        submitButton.textContent = 'Posting...';
        submitButton.disabled = true;

        const response = await fetch(`${API_BASE}/comments`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                mediaTitle: currentVideoId, 
                author: name, 
                text: message,
                avatarIndex: selectedAvatarIndex 
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            
            videoRatingData.comments.push({
                author: result.author,
                text: result.text,
                timestamp: result.timestamp,
                avatarIndex: selectedAvatarIndex,
                id: result.id
            });
        } else {
            throw new Error('Failed to submit comment');
        }

    } catch (error) {
        console.error('Comment error:', error);
    }

    nameInput.value = '';
    messageInput.value = '';
    updateCommentsDisplay();
    
    submitButton.textContent = originalText;
    submitButton.disabled = false;
}

function escapeHtml(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

// ============================================
// LOADING FUNCTIONS
// ============================================

async function loadVideoRatingData(videoId) {
    try {
        // Load comments
        const commentsResponse = await fetch(`${API_BASE}/comments/${encodeURIComponent(videoId)}`);
        if (commentsResponse.ok) {
            const comments = await commentsResponse.json();
            videoRatingData.comments = comments;
        }

        // Load ratings
        const ratingsResponse = await fetch(`${API_BASE}/ratings/${encodeURIComponent(videoId)}`);
        if (ratingsResponse.ok) {
            const ratings = await ratingsResponse.json();
            videoRatingData.ratings = ratings;
        }
    } catch (error) {
        console.error('Failed to load video rating data:', error);
        videoRatingData = {
            ratings: { total: 0, sum: 0, average: 0 },
            comments: []
        };
    }
}

        // Rating system functions and avatar functions would go here...
        // (Including all the rating/comment functionality from the original)

        // ============================================
        // INITIALIZATION
        // ============================================
        
        /**
         * Initialize the entire page
         */
        function initializePage() {
            populateFeaturedVideos();
            populateCategoryFilters();
            populateVideoGallery();
            handleMobileControls();
            setupKeyboardShortcuts();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
    initializePage();
    
    // Add smooth scrolling for category filter on mobile
    const categoryFilters = document.querySelector('.category-filters');
    if (categoryFilters && window.innerWidth <= 480) {
        categoryFilters.style.scrollBehavior = 'smooth';
    }

    // Add search functionality on Enter key
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('keypress', function(event) {
        if (event.key === 'Enter') {
            searchVideos();
        }
    });

    // Real-time search as user types (with debounce)
    let searchTimeout;
    searchInput.addEventListener('input', function() {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(searchVideos, 300);
    });

    // Initialize comment system - wait for layout to be complete
    setTimeout(() => {
        createAvatarRow();
    }, 200);
});

        // Handle window resize
        window.addEventListener('resize', function() {
            handleMobileControls();
        });

        // Cleanup HLS instance on page unload
        window.addEventListener('beforeunload', function() {
            if (hlsInstance) {
                hlsInstance.destroy();
            }
        });

async function loadVideoRatingData(videoId) {
    try {
        console.log('Loading data for video:', videoId);
        
        // Load comments
        const commentsResponse = await fetch(`${API_BASE}/comments/${encodeURIComponent(videoId)}`);
        console.log('Comments response:', commentsResponse.status, commentsResponse.statusText);
        
        if (commentsResponse.ok) {
            const comments = await commentsResponse.json();
            console.log('Comments loaded:', comments);
            videoRatingData.comments = comments;
        } else {
            console.error('Comments request failed:', commentsResponse.status);
        }

        // Load ratings
        const ratingsResponse = await fetch(`${API_BASE}/ratings/${encodeURIComponent(videoId)}`);
        console.log('Ratings response:', ratingsResponse.status, ratingsResponse.statusText);
        
        if (ratingsResponse.ok) {
            const ratings = await ratingsResponse.json();
            console.log('Ratings loaded:', ratings);
            videoRatingData.ratings = ratings;
        } else {
            console.error('Ratings request failed:', ratingsResponse.status);
        }
    } catch (error) {
        console.error('Failed to load video rating data:', error);
        videoRatingData = {
            ratings: { total: 0, sum: 0, average: 0 },
            comments: []
        };
    }
}

        console.log('ðŸŽ¬ WillTube HLS Edition loaded with FIXED progress bar!');
        console.log('ðŸ“¹ Use quickAddVideo() to add new videos');
        console.log('ðŸ”§ Use testHLSUrl() to test video connectivity');
    </script>
</body>
</html>
